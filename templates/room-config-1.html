<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png?v=2">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-page-title="page_title_room_config">Room Configuration - Cold Storage</title>
    <link rel="stylesheet" href="/static/css/bootstrap-icons.min.css">
    <link href="/static/css/tailwind.min.css" rel="stylesheet">
    <link href="/static/css/arbitrary.css" rel="stylesheet">
    <link href="/static/css/fonts.css" rel="stylesheet">
    <link href="/static/css/dark-mode.css" rel="stylesheet">
    <link href="/static/css/responsive.css" rel="stylesheet">
    <link href="/static/css/inventory-theme.css" rel="stylesheet">

    <style>
        * {
            font-family: 'Space Grotesk', sans-serif;
        }
        /* Modern card styling */
        .neu-border {
            border: 1px solid var(--border-color, #e0e6ed);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-radius: 16px;
            transition: all 0.2s ease;
        }
        .neu-border:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        /* Modern input styling */
        .neu-input, .neu-select {
            border: 1px solid var(--border-color, #e0e6ed);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            padding: 0.75rem;
            font-size: 1rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            background-color: #ffffff;
            color: #2c3e50;
        }
        .neu-input:focus, .neu-select:focus {
            outline: none;
            border-color: #4a90a4;
            box-shadow: 0 0 0 3px rgba(74, 144, 164, 0.15);
        }
        /* Modern button styling */
        .neu-button {
            border: 1px solid var(--border-color, #e0e6ed);
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .neu-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .neu-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .hidden { display: none; }
        .clickable-row {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .clickable-row:hover {
            background-color: #FEF3C7;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .spin-animation {
            animation: spin 1s linear infinite;
        }
        .selected-entry {
            background-color: #FDE68A !important;
            border-left: 4px solid #F59E0B;
            border-radius: 8px;
        }
        .room-btn.selected {
            background-color: #10B981 !important;
            color: white !important;
        }
        /* Quantity calculator buttons - colorful style */
        .qty-btn {
            border: none !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08) !important;
            border-radius: 8px !important;
            font-weight: 700;
            transition: all 0.15s ease;
        }
        .qty-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
        }
        .qty-btn-1 { background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%) !important; }
        .qty-btn-2 { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%) !important; }
        .qty-btn-3 { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%) !important; }
        .qty-btn-4 { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%) !important; }

        /* Tablet/Phone Portrait Optimizations */
        @media (max-width: 1023px) and (orientation: portrait) {
            body { font-size: 0.875rem; }
            h1 { font-size: 1.25rem !important; }
            h2 { font-size: 1rem !important; }
            h3 { font-size: 0.875rem !important; }
            .room-btn { padding: 0.5rem !important; font-size: 0.875rem !important; }
            .room-btn div:first-child { font-size: 0.875rem; }
            .room-btn div.text-xs { font-size: 0.625rem; }
            table th, table td { padding: 0.375rem 0.5rem; font-size: 0.75rem; }
            .gatar-cell { padding: 0.125rem !important; font-size: 0.5rem !important; }
            .neu-button.py-2 { padding-top: 0.375rem; padding-bottom: 0.375rem; font-size: 0.7rem; }
        }
    </style>
    <script src="/static/js/theme.js"></script>
</head>
<body class="bg-[#f8fafb] min-h-screen">
    <!-- Navigation Bar -->
    <div class="page-nav">
        <a href="{{.DashboardURL}}" class="nav-btn nav-btn-dashboard">
            <i class="bi bi-house"></i>
            <span data-i18n="dashboard">Dashboard</span>
        </a>
        <div class="flex items-center gap-2">
            <select id="langSelector" onchange="i18n.setLanguage(this.value)" class="lang-toggle">
                <option value="en">EN</option>
                <option value="hi">हिं</option>
            </select>
            <button onclick="history.back()" class="nav-btn nav-btn-back">
                <span data-i18n="back">Back</span>
                <i class="bi bi-arrow-right"></i>
            </button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 md:mb-8 neu-border bg-white p-4 md:p-6 gap-4">
            <div>
                <div class="flex items-center gap-3">
                    <i class="bi bi-door-open text-3xl md:text-4xl text-blue-600"></i>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold" data-i18n="room_config_title">Room Configuration</h1>
                        <p class="text-gray-600 text-sm md:text-base" data-i18n="assign_entries">Assign entries to storage locations</p>
                    </div>
                </div>
            </div>
            <nav class="flex gap-3 md:gap-4 items-center w-full md:w-auto justify-end">
                <!-- Theme Toggle -->
                <button onclick="theme.toggle()" class="nav-btn nav-btn-back" title="Toggle Dark Mode">
                    <i class="bi bi-moon-fill theme-icon-moon"></i>
                    <i class="bi bi-sun-fill theme-icon-sun hidden"></i>
                </button>
            </nav>
        </header>

        <div class="space-y-6">
            <!-- Main Content: Recent Main Entries + Room Entry Form + Recent Room Entries -->
            <div class="w-full">
                <!-- Recent Main Entries (Unassigned) - NOW AT TOP -->
                <div class="neu-border bg-white p-4 md:p-6 mb-6">
                    <div class="flex flex-wrap justify-between items-center mb-4 gap-2">
                        <h2 class="text-xl md:text-2xl font-bold flex items-center gap-2">
                            <i class="bi bi-inbox"></i>
                            <span data-i18n="recent_main_entries">Recent Main Entries</span>
                        </h2>
                        <span class="text-xs text-gray-600 bg-green-50 px-2 py-1 border-2 border-black flex items-center gap-1">
                            <i class="bi bi-arrow-clockwise" id="refreshIcon"></i> <span data-i18n="auto_refresh">Auto-refresh</span> (5s)
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-4" data-i18n="click_entry_assign">Click an entry to assign to room</p>
                    <div class="overflow-auto" style="max-height: 300px;">
                        <table class="w-full">
                            <thead class="sticky top-0 bg-white">
                                <tr class="border-b border-gray-200 bg-gray-50">
                                    <th class="text-left p-2 font-bold text-gray-700" data-i18n="truck_number">Truck No</th>
                                    <th class="text-left p-2 font-bold text-gray-700" data-i18n="name">Name</th>
                                    <th class="text-left p-2 font-bold text-gray-700" data-i18n="qty">Qty</th>
                                </tr>
                            </thead>
                            <tbody id="unassignedEntriesTableBody">
                                <tr>
                                    <td colspan="3" class="text-center p-4 text-gray-500" data-i18n="loading">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Room Entry Form -->
                <div class="neu-border bg-white p-6 mb-8">
                    <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                        <i class="bi bi-door-closed"></i>
                        <span data-i18n="room_entry_form">Room Entry Form</span>
                    </h2>

                    <form id="roomEntryForm" onsubmit="submitRoomEntry(event)">
                        <input type="hidden" id="entryId" />

                        <div class="mb-6 p-4 bg-yellow-50 neu-border">
                            <p class="text-sm font-semibold text-gray-700 mb-2" data-i18n="selected_thok">Selected Thok Number:</p>
                            <p class="text-2xl font-bold text-blue-700" id="selectedThockNumber">-</p>
                            <p class="text-xs text-gray-600 mt-1" id="selectedEntryDetails"></p>
                            <p class="text-sm text-purple-700 font-semibold mt-1" id="selectedEntrySO"></p>
                            <p class="text-sm text-green-700 font-semibold mt-1" id="selectedEntryVariety"></p>
                        </div>

                        <!-- Room and Floor Selection Side by Side -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6">
                            <!-- Left: Room Selection -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span data-i18n="room_no">Room No</span> *
                                </label>
                                <input type="hidden" id="roomNo" required>
                                <div class="space-y-2">
                                    <!-- Row 1: Room 2 and Room 1 (SEED - Green) -->
                                    <div class="grid grid-cols-2 gap-3">
                                        <button type="button" id="room-btn-2" onclick="selectRoom('2')" data-room="2" data-type="seed" class="room-btn neu-button bg-green-100 border-2 border-green-400 hover:bg-green-200 py-3 text-lg font-bold transition-all">
                                            <div data-i18n="room_2">Room 2</div>
                                            <div class="text-xs text-green-700 font-normal" data-i18n="seed_label">Seed</div>
                                        </button>
                                        <button type="button" id="room-btn-1" onclick="selectRoom('1')" data-room="1" data-type="seed" class="room-btn neu-button bg-green-100 border-2 border-green-400 hover:bg-green-200 py-3 text-lg font-bold transition-all">
                                            <div data-i18n="room_1">Room 1</div>
                                            <div class="text-xs text-green-700 font-normal" data-i18n="seed_label">Seed</div>
                                        </button>
                                    </div>
                                    <!-- Row 2: Gallery (SELL - Orange) -->
                                    <div class="flex justify-center">
                                        <button type="button" id="room-btn-G" onclick="selectRoom('G')" data-room="G" data-type="sell" class="room-btn neu-button bg-orange-100 border-2 border-orange-400 hover:bg-orange-200 py-3 px-8 text-lg font-bold w-full transition-all">
                                            <div data-i18n="room_gallery">Gallery</div>
                                            <div class="text-xs text-orange-700 font-normal" data-i18n="sell_label">Sell</div>
                                        </button>
                                    </div>
                                    <!-- Row 3: Room 3 and Room 4 (SELL - Orange) -->
                                    <div class="grid grid-cols-2 gap-3">
                                        <button type="button" id="room-btn-3" onclick="selectRoom('3')" data-room="3" data-type="sell" class="room-btn neu-button bg-orange-100 border-2 border-orange-400 hover:bg-orange-200 py-3 text-lg font-bold transition-all">
                                            <div data-i18n="room_3">Room 3</div>
                                            <div class="text-xs text-orange-700 font-normal" data-i18n="sell_label">Sell</div>
                                        </button>
                                        <button type="button" id="room-btn-4" onclick="selectRoom('4')" data-room="4" data-type="sell" class="room-btn neu-button bg-orange-100 border-2 border-orange-400 hover:bg-orange-200 py-3 text-lg font-bold transition-all">
                                            <div data-i18n="room_4">Room 4</div>
                                            <div class="text-xs text-orange-700 font-normal" data-i18n="sell_label">Sell</div>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Floor is now selected from the room layout display below -->
                            <input type="hidden" id="floor" required>
                        </div>

                        <!-- Room Layout Display -->
                        <div id="roomLayoutDisplay" class="mb-6">
                            <div class="text-center p-4 bg-gray-50 border-2 border-dashed border-gray-300 rounded">
                                <p class="text-gray-500" data-i18n="select_room_see_layout">Select a room to see gatar layout</p>
                            </div>
                        </div>

                        <!-- Gatar Input -->
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <span data-i18n="gatar_no">Gatar No</span> *
                            </label>
                            <input
                                type="text"
                                id="gateNo"
                                required
                                class="w-full neu-input"
                                data-i18n-placeholder="enter_gatar_number"
                                placeholder="Enter gatar number (or select from grid above)"
                            >
                            <div id="gatarHint" class="mt-2 text-sm hidden"></div>
                        </div>

                        <!-- Quantity Calculator (Now inside form) -->
                        <div class="mb-6 rounded-2xl bg-gradient-to-br from-purple-50 to-indigo-50 p-4 border border-purple-200">
                            <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                                <i class="bi bi-calculator text-purple-600"></i>
                                <span data-i18n="quantity_calculator">Quantity Calculator</span>
                                <span class="ml-auto text-2xl font-bold text-purple-700 bg-white px-3 py-1 rounded-lg shadow-sm" id="totalQuantity">0</span>
                            </h3>
                            <!-- Hidden input for form submission -->
                            <input type="hidden" id="quantity" required min="1">

                            <!-- Selected Gatars Display - shows which gatars need quantities -->
                            <div id="selectedGatarsInCalculator" class="mb-3 p-2 bg-green-50 border border-green-300 rounded-lg hidden">
                                <div class="flex items-center gap-2 flex-wrap">
                                    <span class="text-sm font-bold text-green-700">
                                        <i class="bi bi-grid-3x3 mr-1"></i>Gatars to fill:
                                    </span>
                                    <span id="gatarsToFillList" class="text-sm font-mono text-green-800"></span>
                                    <span id="gatarsFillProgress" class="ml-auto text-xs bg-green-200 text-green-800 px-2 py-0.5 rounded-full font-bold"></span>
                                </div>
                            </div>

                            <!-- Preset Value Buttons - Colorful gradient style -->
                            <p class="text-xs text-purple-600 mb-2" data-i18n="click_to_add">Click values above to add...</p>
                            <div class="grid grid-cols-8 gap-1.5 mb-3">
                                <button type="button" onclick="addQuantity(1)" class="qty-btn qty-btn-1 py-2 text-sm">1</button>
                                <button type="button" onclick="addQuantity(2)" class="qty-btn qty-btn-1 py-2 text-sm">2</button>
                                <button type="button" onclick="addQuantity(3)" class="qty-btn qty-btn-1 py-2 text-sm">3</button>
                                <button type="button" onclick="addQuantity(4)" class="qty-btn qty-btn-1 py-2 text-sm">4</button>
                                <button type="button" onclick="addQuantity(5)" class="qty-btn qty-btn-1 py-2 text-sm">5</button>
                                <button type="button" onclick="addQuantity(6)" class="qty-btn qty-btn-1 py-2 text-sm">6</button>
                                <button type="button" onclick="addQuantity(7)" class="qty-btn qty-btn-1 py-2 text-sm">7</button>
                                <button type="button" onclick="addQuantity(8)" class="qty-btn qty-btn-2 py-2 text-sm">8</button>
                                <button type="button" onclick="addQuantity(9)" class="qty-btn qty-btn-2 py-2 text-sm">9</button>
                                <button type="button" onclick="addQuantity(10)" class="qty-btn qty-btn-2 py-2 text-sm">10</button>
                                <button type="button" onclick="addQuantity(11)" class="qty-btn qty-btn-2 py-2 text-sm">11</button>
                                <button type="button" onclick="addQuantity(12)" class="qty-btn qty-btn-2 py-2 text-sm">12</button>
                                <button type="button" onclick="addQuantity(13)" class="qty-btn qty-btn-2 py-2 text-sm">13</button>
                                <button type="button" onclick="addQuantity(14)" class="qty-btn qty-btn-2 py-2 text-sm">14</button>
                                <button type="button" onclick="addQuantity(15)" class="qty-btn qty-btn-2 py-2 text-sm">15</button>
                                <button type="button" onclick="addQuantity(16)" class="qty-btn qty-btn-2 py-2 text-sm">16</button>
                                <button type="button" onclick="addQuantity(17)" class="qty-btn qty-btn-2 py-2 text-sm">17</button>
                                <button type="button" onclick="addQuantity(18)" class="qty-btn qty-btn-3 py-2 text-sm">18</button>
                                <button type="button" onclick="addQuantity(19)" class="qty-btn qty-btn-3 py-2 text-sm">19</button>
                                <button type="button" onclick="addQuantity(20)" class="qty-btn qty-btn-3 py-2 text-sm">20</button>
                                <button type="button" onclick="addQuantity(21)" class="qty-btn qty-btn-3 py-2 text-sm">21</button>
                                <button type="button" onclick="addQuantity(24)" class="qty-btn qty-btn-3 py-2 text-sm">24</button>
                                <button type="button" onclick="addQuantity(25)" class="qty-btn qty-btn-3 py-2 text-sm">25</button>
                                <button type="button" onclick="addQuantity(26)" class="qty-btn qty-btn-3 py-2 text-sm">26</button>
                                <button type="button" onclick="addQuantity(27)" class="qty-btn qty-btn-3 py-2 text-sm">27</button>
                                <button type="button" onclick="addQuantity(30)" class="qty-btn qty-btn-4 py-2 text-sm">30</button>
                                <button type="button" onclick="showCustomInput()" class="qty-btn bg-gradient-to-br from-purple-200 to-purple-300 py-2 text-xs col-span-1">+</button>
                            </div>

                            <!-- Custom Input (Hidden by default) -->
                            <div id="customInputDiv" class="hidden mb-3">
                                <div class="flex gap-2">
                                    <input type="number" id="customQuantityInput" min="1" class="flex-1 border-2 border-black p-2 text-base" placeholder="Custom value">
                                    <button type="button" onclick="addCustomQuantity()" class="neu-button bg-green-500 text-white px-3 text-sm">Add</button>
                                    <button type="button" onclick="hideCustomInput()" class="neu-button bg-gray-300 px-3 text-sm">✕</button>
                                </div>
                            </div>

                            <!-- Selected Values (Chips) -->
                            <div id="quantityChips" class="flex flex-wrap gap-2 min-h-[40px] p-2 bg-white border-2 border-gray-300 rounded mb-3">
                                <span class="text-sm text-gray-400 self-center" data-i18n="click_values_add">Click values above to add...</span>
                            </div>

                            <!-- Quality Buttons (N/U/D/G) - Now inside calculator -->
                            <div class="flex items-center gap-2 mb-3 p-3 bg-white/60 rounded-xl">
                                <span class="text-sm font-bold text-purple-800">
                                    <i class="bi bi-bookmark-check mr-1"></i><span data-i18n="quality">Quality</span>:
                                </span>
                                <span id="pendingQtyDisplay" class="text-sm text-purple-600 font-bold hidden bg-purple-100 px-2 py-0.5 rounded">
                                    (<span id="pendingQtyValue">0</span>)
                                </span>
                                <div class="flex gap-1.5 ml-2">
                                    <button type="button" onclick="addWithQuality('N')" class="bg-gradient-to-br from-green-400 to-green-500 hover:from-green-500 hover:to-green-600 text-white py-1.5 px-4 text-sm font-bold rounded-lg shadow-md hover:shadow-lg transition-all">N</button>
                                    <button type="button" onclick="addWithQuality('U')" class="bg-gradient-to-br from-yellow-400 to-amber-500 hover:from-yellow-500 hover:to-amber-600 text-white py-1.5 px-4 text-sm font-bold rounded-lg shadow-md hover:shadow-lg transition-all">U</button>
                                    <button type="button" onclick="addWithQuality('D')" class="bg-gradient-to-br from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white py-1.5 px-4 text-sm font-bold rounded-lg shadow-md hover:shadow-lg transition-all">D</button>
                                    <button type="button" onclick="addWithQuality('G')" class="bg-gradient-to-br from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white py-1.5 px-4 text-sm font-bold rounded-lg shadow-md hover:shadow-lg transition-all">G</button>
                                </div>
                                <button type="button" onclick="clearAllQuantities()" class="ml-auto bg-gradient-to-br from-gray-400 to-gray-500 hover:from-red-500 hover:to-red-600 text-white py-1.5 px-3 text-sm font-bold rounded-lg shadow-md transition-all">
                                    <i class="bi bi-trash"></i> <span data-i18n="clear">Clear</span>
                                </button>
                            </div>

                            <!-- Quality Remarks Display -->
                            <div id="qualityRemarksList" class="flex flex-wrap gap-2 min-h-[24px]"></div>
                        </div>

                        <!-- Quantity Warning Banner (shown when less than expected) -->
                        <div id="quantityWarning" class="hidden mb-4 p-3 neu-border bg-yellow-100 border-yellow-500">
                            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2">
                                <div class="flex items-center gap-2">
                                    <i class="bi bi-exclamation-triangle text-yellow-700 text-xl"></i>
                                    <span class="font-bold text-yellow-800" id="warningMessage"></span>
                                </div>
                                <button type="button" onclick="confirmNoRemark()" class="neu-button bg-gray-200 text-sm px-4 py-2">
                                    <i class="bi bi-x-circle"></i> <span data-i18n="no_remark">No Remark</span>
                                </button>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2" data-i18n="remark">
                                Remark
                            </label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-2">
                                <label class="neu-border p-2 md:p-3 cursor-pointer hover:bg-red-50 transition-colors flex items-center">
                                    <input type="checkbox" name="remarkType" value="red" class="mr-2">
                                    <span class="font-bold text-red-600" data-i18n="remark_red">Red</span>
                                </label>
                                <label class="neu-border p-2 md:p-3 cursor-pointer hover:bg-yellow-50 transition-colors flex items-center">
                                    <input type="checkbox" name="remarkType" value="yellow" class="mr-2">
                                    <span class="font-bold text-yellow-600" data-i18n="remark_yellow">Yellow</span>
                                </label>
                                <label class="neu-border p-2 md:p-3 cursor-pointer hover:bg-gray-50 transition-colors flex items-center">
                                    <input type="checkbox" name="remarkType" value="white" class="mr-2">
                                    <span class="font-bold text-gray-600" data-i18n="remark_white">White</span>
                                </label>
                                <label class="neu-border p-2 md:p-3 cursor-pointer hover:bg-green-50 transition-colors flex items-center">
                                    <input type="checkbox" name="remarkType" value="green" class="mr-2">
                                    <span class="font-bold text-green-600" data-i18n="remark_green">Green</span>
                                </label>
                                <label class="neu-border p-2 md:p-3 cursor-pointer hover:bg-cyan-50 transition-colors flex items-center">
                                    <input type="checkbox" name="remarkType" value="less" class="mr-2">
                                    <span class="font-bold text-cyan-600" data-i18n="remark_less">Less</span>
                                </label>
                                <label class="neu-border p-2 md:p-3 cursor-pointer hover:bg-purple-50 transition-colors flex items-center">
                                    <input type="checkbox" name="remarkType" value="extra" class="mr-2">
                                    <span class="font-bold text-purple-600" data-i18n="remark_extra">Extra</span>
                                </label>
                                <label class="neu-border p-2 md:p-3 cursor-pointer hover:bg-orange-50 transition-colors flex items-center">
                                    <input type="checkbox" name="remarkType" value="mix" class="mr-2">
                                    <span class="font-bold text-orange-600" data-i18n="remark_mix">Mix</span>
                                </label>
                                <label class="neu-border p-2 md:p-3 cursor-pointer hover:bg-blue-50 transition-colors flex items-center">
                                    <input type="checkbox" name="remarkType" value="custom" class="mr-2" onchange="toggleCustomRemark()">
                                    <span class="font-bold text-blue-600" data-i18n="remark_custom">Custom</span>
                                </label>
                            </div>
                            <input
                                type="text"
                                id="customRemark"
                                class="w-full neu-input hidden"
                                data-i18n-placeholder="enter_custom_remark"
                                placeholder="Enter custom remark"
                            >
                        </div>

                        <div class="flex gap-4">
                            <button type="submit" class="neu-button bg-blue-500 text-white flex-1">
                                <i class="bi bi-check-circle"></i> <span data-i18n="submit_room_entry">Submit Room Entry</span>
                            </button>
                            <button type="button" onclick="resetForm()" class="neu-button bg-gray-300">
                                <i class="bi bi-x-circle"></i> <span data-i18n="reset">Reset</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Recent Room Entries -->
                <div class="neu-border bg-white p-4 md:p-6">
                    <h2 class="text-xl md:text-2xl font-bold mb-4 flex items-center gap-2">
                        <i class="bi bi-list-check"></i>
                        <span data-i18n="recent_room_entries">Recent Room Entries</span>
                    </h2>
                    <div class="overflow-x-auto" style="max-height: 400px;">
                        <table class="w-full min-w-[500px]">
                            <thead class="sticky top-0 bg-white">
                                <tr class="border-b-2 border-black">
                                    <th class="text-left p-2 font-bold" data-i18n="truck_number">Truck No</th>
                                    <th class="text-left p-2 font-bold" data-i18n="room">Room</th>
                                    <th class="text-left p-2 font-bold" data-i18n="floor">Floor</th>
                                    <th class="text-left p-2 font-bold" data-i18n="gatar">Gatar</th>
                                    <th class="text-left p-2 font-bold" data-i18n="remark">Remark</th>
                                    <th class="text-left p-2 font-bold" data-i18n="qty">Qty</th>
                                    <th class="text-left p-2 font-bold" data-i18n="date">Date</th>
                                </tr>
                            </thead>
                            <tbody id="roomEntriesTableBody">
                                <tr>
                                    <td colspan="7" class="text-center p-4 text-gray-500" data-i18n="loading">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- i18n Script -->
    <script src="/static/js/prefetch.js?v=5"></script>
    <script src="/static/js/i18n.js"></script>
    <script>
        // Update language selector on load
        document.addEventListener('DOMContentLoaded', function() {
            const lang = localStorage.getItem('lang') || 'hi';
            document.getElementById('langSelector').value = lang;
        });

        // Capitalize first letter function
        function capitalizeFirstLetter(input) {
            const value = input.value;
            if (value.length > 0) {
                input.value = value.charAt(0).toUpperCase() + value.slice(1);
            }
        }

        // Auto-apply capitalization to all text inputs
        document.addEventListener('DOMContentLoaded', function() {
            const textInputs = document.querySelectorAll('input[type="text"]:not([disabled]):not([type="email"]):not([type="tel"])');
            textInputs.forEach(input => {
                input.addEventListener('input', function() {
                    capitalizeFirstLetter(this);
                });
            });
        });

        const token = localStorage.getItem('token');
        let selectedEntry = null;
        let entriesRefreshInterval = null;
        let quantityValues = [];
        let noRemarkConfirmed = false;
        let pendingQuantity = null;  // Holds quantity while waiting for quality selection
        let qualityRemarks = [];     // Stores {quantity, quality} pairs

        // Gatar ranges mapping: room -> floor -> {start, end, cols, rows}
        // Layout pattern: Column pairs where each pair has 20 gatars (10 rows × 2 cols)
        // Left col of pair has odd positions (1,3,5...), right col has even (2,4,6...)
        const gatarRanges = {
            '1': {
                '0': { start: 1, end: 140, cols: 14, rows: 10 },
                '1': { start: 141, end: 280, cols: 14, rows: 10 },
                '2': { start: 281, end: 420, cols: 14, rows: 10 },
                '3': { start: 421, end: 560, cols: 14, rows: 10 },
                '4': { start: 561, end: 680, cols: 12, rows: 10 }
            },
            '2': {
                '0': { start: 681, end: 820, cols: 14, rows: 10 },
                '1': { start: 821, end: 960, cols: 14, rows: 10 },
                '2': { start: 961, end: 1100, cols: 14, rows: 10 },
                '3': { start: 1101, end: 1240, cols: 14, rows: 10 },
                '4': { start: 1241, end: 1360, cols: 12, rows: 10 }
            },
            '3': {
                '0': { start: 1361, end: 1500, cols: 14, rows: 10 },
                '1': { start: 1501, end: 1640, cols: 14, rows: 10 },
                '2': { start: 1641, end: 1780, cols: 14, rows: 10 },
                '3': { start: 1781, end: 1920, cols: 14, rows: 10 },
                '4': { start: 1921, end: 2040, cols: 12, rows: 10 }
            },
            '4': {
                '0': { ranges: [{start: 2041, end: 2120, cols: 8}, {start: 2869, end: 2928, cols: 6}], cols: 14, rows: 10 },
                '1': { start: 2121, end: 2260, cols: 14, rows: 10 },
                '2': { start: 2261, end: 2400, cols: 14, rows: 10 },
                '3': { start: 2401, end: 2540, cols: 14, rows: 10 },
                '4': { start: 2601, end: 2720, cols: 12, rows: 10 }
            },
            'G': {
                '0': { start: 2727, end: 2756, cols: 2, rows: 15 },
                '1': { start: 2757, end: 2784, cols: 2, rows: 14 },
                '2': { start: 2785, end: 2812, cols: 2, rows: 14 },
                '3': { start: 2813, end: 2840, cols: 2, rows: 14 },
                '4': { start: 2841, end: 2868, cols: 2, rows: 14 }
            }
        };

        // Function to get gatar number at grid position (row, col) for a floor
        // Pattern: Column pairs where left col has odd row indices, right col has even
        function getGatarAtPosition(floorData, row, col) {
            const cols = floorData.cols || 14;

            // Handle split ranges (Room 4 Floor 0)
            if (floorData.ranges) {
                let colOffset = 0;
                for (const range of floorData.ranges) {
                    const rangeCols = range.cols || 8;
                    if (col < colOffset + rangeCols) {
                        const localCol = col - colOffset;
                        const pairIndex = Math.floor(localCol / 2);
                        const isLeftCol = localCol % 2 === 0;
                        const baseForPair = range.start + (pairIndex * 20);
                        const gatarOffset = isLeftCol ? (row * 2 + 1) : (row * 2 + 2);
                        return baseForPair + gatarOffset - 1;
                    }
                    colOffset += rangeCols;
                }
                return null;
            }

            // Handle Gallery (simple sequential in 2 columns)
            if (cols === 2) {
                return floorData.start + (row * 2) + col;
            }

            // Standard room layout: column pairs with 20 gatars each
            const pairIndex = Math.floor(col / 2);
            const isLeftCol = col % 2 === 0;
            const baseForPair = floorData.start + (pairIndex * 20);
            const gatarOffset = isLeftCol ? (row * 2 + 1) : (row * 2 + 2);
            return baseForPair + gatarOffset - 1;
        }

        // Track selected gatar numbers (multiple)
        let selectedGatars = [];

        // Track current entry type (seed or sell)
        let currentEntryType = null;

        // Room type mapping
        const roomTypes = {
            '1': 'seed',
            '2': 'seed',
            '3': 'sell',
            '4': 'sell',
            'G': 'sell'
        };

        // Get entry type from truck number
        function getEntryType(truckNumber) {
            if (!truckNumber) return null;
            const num = parseInt(truckNumber.split('/')[0]);
            return num <= 1500 ? 'seed' : 'sell';
        }

        // Enable a room button
        function enableRoom(roomId) {
            const btn = document.getElementById(`room-btn-${roomId}`);
            if (!btn) return;

            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-200', 'border-gray-300');

            // Restore original colors
            if (roomTypes[roomId] === 'seed') {
                btn.classList.add('bg-green-100', 'border-green-400', 'hover:bg-green-200');
            } else {
                btn.classList.add('bg-orange-100', 'border-orange-400', 'hover:bg-orange-200');
            }
            btn.title = '';
        }

        // Disable a room button
        function disableRoom(roomId, reason) {
            const btn = document.getElementById(`room-btn-${roomId}`);
            if (!btn) return;

            btn.disabled = true;
            btn.classList.remove('bg-green-100', 'border-green-400', 'hover:bg-green-200',
                                 'bg-orange-100', 'border-orange-400', 'hover:bg-orange-200',
                                 'selected', 'bg-green-500', 'bg-orange-500', 'text-white');
            btn.classList.add('opacity-50', 'cursor-not-allowed', 'bg-gray-200', 'border-gray-300');
            btn.title = reason;
        }

        // Update room availability based on entry type
        function updateRoomAvailability(entryType) {
            const seedRooms = ['1', '2'];
            const sellRooms = ['3', '4', 'G'];

            // Clear current room selection if it doesn't match
            const currentRoom = document.getElementById('roomNo').value;
            if (currentRoom && roomTypes[currentRoom] !== entryType) {
                document.getElementById('roomNo').value = '';
                document.querySelectorAll('.room-btn').forEach(btn => {
                    btn.classList.remove('selected', 'bg-green-500', 'bg-orange-500', 'text-white', 'border-green-600', 'border-orange-600');
                });
            }

            if (entryType === 'seed') {
                // Enable rooms 1, 2 - Disable rooms 3, 4, G
                seedRooms.forEach(r => enableRoom(r));
                sellRooms.forEach(r => disableRoom(r, 'बीज entries केवल Room 1 & 2 में store होते हैं'));
            } else if (entryType === 'sell') {
                // Enable rooms 3, 4, G - Disable rooms 1, 2
                sellRooms.forEach(r => enableRoom(r));
                seedRooms.forEach(r => disableRoom(r, 'बिक्री entries केवल Room 3, 4 & Gallery में store होते हैं'));
            } else {
                // No entry selected - enable all
                [...seedRooms, ...sellRooms].forEach(r => enableRoom(r));
            }
        }

        // Function to toggle gatar selection
        function selectGatar(gatarNo) {
            const index = selectedGatars.indexOf(gatarNo);

            if (index > -1) {
                // Already selected - remove it
                selectedGatars.splice(index, 1);
            } else {
                // Not selected - add it
                selectedGatars.push(gatarNo);
            }

            // Sort the array
            selectedGatars.sort((a, b) => a - b);

            // Update input field with comma-separated values
            document.getElementById('gateNo').value = selectedGatars.join(', ');

            // Update visual selection
            updateGatarGridSelection();

            // Update selection summary
            updateSelectionSummary();
        }

        // Function to update visual selection in grid
        function updateGatarGridSelection() {
            document.querySelectorAll('.gatar-cell').forEach(cell => {
                const gatarNo = parseInt(cell.textContent.trim());
                if (selectedGatars.includes(gatarNo)) {
                    cell.classList.remove('bg-white', 'hover:bg-blue-100');
                    cell.classList.add('bg-green-500', 'text-white');
                } else {
                    cell.classList.remove('bg-green-500', 'text-white');
                    cell.classList.add('bg-white', 'hover:bg-blue-100');
                }
            });
        }

        // Function to update the gatars display in the Quantity Calculator section
        function updateGatarsInCalculator() {
            const container = document.getElementById('selectedGatarsInCalculator');
            const listSpan = document.getElementById('gatarsToFillList');
            const progressSpan = document.getElementById('gatarsFillProgress');

            if (selectedGatars.length === 0) {
                container.classList.add('hidden');
                return;
            }

            container.classList.remove('hidden');

            // Show gatars list
            const display = formatGatarSelection(selectedGatars);
            listSpan.textContent = display;

            // Show progress: X of Y filled
            const filled = quantityValues.length;
            const total = selectedGatars.length;

            if (filled === total && total > 0) {
                progressSpan.textContent = `✓ ${filled}/${total} filled`;
                progressSpan.className = 'ml-auto text-xs bg-green-500 text-white px-2 py-0.5 rounded-full font-bold';
            } else if (filled > total) {
                progressSpan.textContent = `⚠ ${filled}/${total} (extra!)`;
                progressSpan.className = 'ml-auto text-xs bg-red-500 text-white px-2 py-0.5 rounded-full font-bold';
            } else {
                progressSpan.textContent = `${filled}/${total} filled`;
                progressSpan.className = 'ml-auto text-xs bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full font-bold';
            }
        }

        // Function to update selection summary display - shows gatars and distribution preview
        function updateSelectionSummary() {
            const summaryDiv = document.getElementById('selectionSummary');
            if (!summaryDiv) return;

            // Also update the calculator display
            updateGatarsInCalculator();

            if (selectedGatars.length === 0) {
                summaryDiv.innerHTML = `
                    <p class="text-gray-500 text-sm">No gatars selected - Click on numbers below to select gatars</p>
                `;
            } else {
                // Format display - show ranges if consecutive
                const display = formatGatarSelection(selectedGatars);

                // Check if we have quantity breakdown values
                const hasQuantities = quantityValues.length > 0;
                const matchCount = selectedGatars.length === quantityValues.length;

                let html = `
                    <div class="space-y-2">
                        <div class="flex items-center justify-between mb-2">
                            <div>
                                <span class="font-bold text-green-700">${selectedGatars.length} Gatar${selectedGatars.length > 1 ? 's' : ''} Selected:</span>
                                <span class="ml-2 font-mono text-green-800">${display}</span>
                            </div>
                            <button onclick="clearGatarSelection()" class="px-3 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 text-sm font-bold">
                                <i class="bi bi-x-circle mr-1"></i>Clear
                            </button>
                        </div>
                `;

                // Show mismatch warning if gatars != breakdown values
                if (hasQuantities && !matchCount) {
                    html += `
                        <div class="bg-yellow-100 border border-yellow-400 text-yellow-800 p-2 rounded text-sm">
                            <i class="bi bi-exclamation-triangle mr-1"></i>
                            <strong>Warning:</strong> ${selectedGatars.length} gatars selected but ${quantityValues.length} quantities entered.
                            They must match!
                        </div>
                    `;
                }

                // Show distribution preview if quantities match gatars
                if (hasQuantities && matchCount) {
                    html += `
                        <div class="bg-blue-50 border border-blue-300 rounded p-2">
                            <p class="text-xs text-blue-700 font-bold mb-1">Distribution Preview:</p>
                            <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-1 text-xs">
                    `;
                    selectedGatars.forEach((gatarNo, idx) => {
                        const qty = quantityValues[idx] || 0;
                        const quality = qualityRemarks[idx]?.quality || 'N';
                        html += `
                            <div class="bg-white p-1 rounded border text-center">
                                <span class="font-bold text-purple-700">G${gatarNo}</span>
                                <span class="text-gray-600">→</span>
                                <span class="font-bold">${qty}</span>
                                <span class="text-xs text-gray-500">(${quality})</span>
                            </div>
                        `;
                    });
                    html += `
                            </div>
                        </div>
                    `;
                }

                html += `</div>`;
                summaryDiv.innerHTML = html;
            }
        }

        // Remove a specific gatar from selection
        function removeGatarFromSelection(gatarNo) {
            const index = selectedGatars.indexOf(gatarNo);
            if (index > -1) {
                selectedGatars.splice(index, 1);
            }
            document.getElementById('gateNo').value = selectedGatars.join(', ');
            updateGatarGridSelection();
            updateSelectionSummary();
        }

        // Format gatar selection to show ranges (e.g., "1-5, 10, 15-20")
        function formatGatarSelection(gatars) {
            if (gatars.length === 0) return '';
            if (gatars.length === 1) return gatars[0].toString();

            const ranges = [];
            let rangeStart = gatars[0];
            let rangeEnd = gatars[0];

            for (let i = 1; i < gatars.length; i++) {
                if (gatars[i] === rangeEnd + 1) {
                    rangeEnd = gatars[i];
                } else {
                    ranges.push(rangeStart === rangeEnd ? `${rangeStart}` : `${rangeStart}-${rangeEnd}`);
                    rangeStart = gatars[i];
                    rangeEnd = gatars[i];
                }
            }
            ranges.push(rangeStart === rangeEnd ? `${rangeStart}` : `${rangeStart}-${rangeEnd}`);

            return ranges.join(', ');
        }

        // Clear all selected gatars
        function clearGatarSelection() {
            selectedGatars = [];
            document.getElementById('gateNo').value = '';
            updateGatarGridSelection();
            updateSelectionSummary();
        }

        // Select range of gatars
        function selectGatarRange(start, end) {
            for (let g = start; g <= end; g++) {
                if (!selectedGatars.includes(g)) {
                    selectedGatars.push(g);
                }
            }
            selectedGatars.sort((a, b) => a - b);
            document.getElementById('gateNo').value = selectedGatars.join(', ');
            updateGatarGridSelection();
            updateSelectionSummary();
        }

        // Select all gatars in current floor
        function selectAllGatars() {
            const roomNo = document.getElementById('roomNo').value;
            const floor = document.getElementById('floor').value;
            if (roomNo && floor && gatarRanges[roomNo] && gatarRanges[roomNo][floor]) {
                const floorData = gatarRanges[roomNo][floor];
                const cols = floorData.cols || 14;
                const rows = floorData.rows || 10;

                // Clear and rebuild selected gatars from grid positions
                selectedGatars = [];
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < cols; col++) {
                        const g = getGatarAtPosition(floorData, row, col);
                        if (g !== null) {
                            selectedGatars.push(g);
                        }
                    }
                }
                selectedGatars.sort((a, b) => a - b);
                document.getElementById('gateNo').value = selectedGatars.join(', ');
                updateGatarGridSelection();
                updateSelectionSummary();
            }
        }

        // Function to display room layout
        function displayRoomLayout(roomNo) {
            const layoutDiv = document.getElementById('roomLayoutDisplay');
            if (!layoutDiv) return;

            const roomData = gatarRanges[roomNo];
            if (!roomData || Object.keys(roomData).length === 0) {
                layoutDiv.innerHTML = `
                    <div class="text-center p-4 bg-yellow-50 border-2 border-yellow-400 rounded">
                        <p class="text-yellow-700 font-bold">Room ${roomNo === 'G' ? 'Gallery' : roomNo} - Layout Pending</p>
                        <p class="text-sm text-yellow-600">Gatar data will be added soon</p>
                    </div>
                `;
                return;
            }

            const roomName = roomNo === 'G' ? 'Gallery' : `Room ${roomNo}`;
            const selectedFloor = document.getElementById('floor').value;

            // Calculate total gatars in this room
            let totalGatars = 0;
            let minGatar = Infinity;
            let maxGatar = 0;
            for (let f = 0; f <= 4; f++) {
                const fd = roomData[f.toString()];
                if (fd) {
                    // Handle split ranges
                    if (fd.ranges) {
                        for (const r of fd.ranges) {
                            totalGatars += (r.end - r.start + 1);
                            if (r.start < minGatar) minGatar = r.start;
                            if (r.end > maxGatar) maxGatar = r.end;
                        }
                    } else {
                        totalGatars += (fd.end - fd.start + 1);
                        if (fd.start < minGatar) minGatar = fd.start;
                        if (fd.end > maxGatar) maxGatar = fd.end;
                    }
                }
            }

            let html = `
                <div class="neu-border bg-gradient-to-b from-blue-50 to-blue-100 p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold text-blue-800 text-lg">${roomName} - Complete Layout</h4>
                        <div class="text-right">
                            <span class="text-sm text-gray-600">Total Gatars:</span>
                            <span class="font-bold text-blue-700 ml-1">${totalGatars}</span>
                            <span class="text-xs text-gray-500 ml-2">(${minGatar}-${maxGatar})</span>
                        </div>
                    </div>

                    <!-- Floor Selection Bar -->
                    <div class="bg-white p-3 rounded border-2 border-blue-300 mb-3">
                        <div class="text-center text-xs text-gray-500 mb-2">SELECT FLOOR - ${roomName.toUpperCase()}</div>
                        <div class="flex gap-2 justify-center">
            `;

            // Display floor buttons
            for (let floor = 4; floor >= 0; floor--) {
                const floorData = roomData[floor.toString()];
                const isSelected = selectedFloor === floor.toString();

                if (floorData) {
                    // Calculate display range for button
                    let floorRangeText = '';
                    if (floorData.ranges) {
                        floorRangeText = floorData.ranges.map(r => `${r.start}-${r.end}`).join('+');
                    } else {
                        floorRangeText = `${floorData.start}-${floorData.end}`;
                    }
                    html += `
                        <button onclick="selectFloor(${floor})"
                            class="px-4 py-2 rounded-lg font-bold transition-all ${isSelected
                                ? 'bg-green-500 text-white shadow-lg'
                                : 'bg-gray-100 hover:bg-blue-100 border border-gray-300'}">
                            Floor ${floor}
                            <span class="block text-xs ${isSelected ? 'text-green-100' : 'text-gray-500'}">${floorRangeText}</span>
                        </button>
                    `;
                } else {
                    html += `
                        <button disabled class="px-4 py-2 rounded-lg font-bold bg-gray-200 text-gray-400 cursor-not-allowed">
                            Floor ${floor}
                            <span class="block text-xs">N/A</span>
                        </button>
                    `;
                }
            }

            html += `
                        </div>
                    </div>
            `;

            // Show clickable gatar grid if floor is selected
            if (selectedFloor && roomData[selectedFloor]) {
                const selFloorData = roomData[selectedFloor];
                const cols = selFloorData.cols || 14;
                const rows = selFloorData.rows || 10;
                const gatarCount = cols * rows;

                // Calculate range display text
                let rangeText = '';
                if (selFloorData.ranges) {
                    rangeText = selFloorData.ranges.map(r => `${r.start}-${r.end}`).join(' + ');
                } else {
                    rangeText = `${selFloorData.start} - ${selFloorData.end}`;
                }

                html += `
                    <div class="bg-green-50 border-2 border-green-400 rounded-lg p-3 mb-3">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <span class="text-green-800 font-bold text-lg">
                                    <i class="bi bi-geo-alt-fill mr-2"></i>
                                    ${roomName} - Floor ${selectedFloor}
                                </span>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="selectAllGatars()" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm font-bold">
                                    <i class="bi bi-check-all mr-1"></i>Select All
                                </button>
                                <button onclick="clearGatarSelection()" class="px-3 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 text-sm font-bold">
                                    <i class="bi bi-x-circle mr-1"></i>Clear
                                </button>
                            </div>
                        </div>

                        <!-- Selection Summary -->
                        <div id="selectionSummary" class="bg-white rounded p-2 mb-3 border border-green-300">
                            <p class="text-gray-500 text-sm">No gatars selected - Click on numbers below</p>
                        </div>

                        <!-- Gatar Number Grid - Actual Layout -->
                        <div class="bg-white rounded-lg p-3 border border-green-300">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-xs text-gray-500">
                                    <i class="bi bi-hand-index-thumb mr-1"></i> CLICK TO SELECT/DESELECT
                                </span>
                                <span class="text-xs text-gray-600 font-bold">
                                    Range: ${rangeText} (${gatarCount} gatars)
                                </span>
                            </div>
                            <!-- Column Headers -->
                            <div class="grid gap-1 mb-1" style="grid-template-columns: repeat(${cols}, minmax(0, 1fr));">
                `;

                // Add column headers
                for (let c = 0; c < cols; c++) {
                    html += `<div class="text-center text-xs text-gray-400 font-bold">C${c + 1}</div>`;
                }

                html += `</div>
                            <div class="grid gap-1 max-h-80 overflow-y-auto p-1" style="grid-template-columns: repeat(${cols}, minmax(0, 1fr));">
                `;

                // Generate clickable gatar cells in correct layout order (row by row, column by column)
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < cols; col++) {
                        const g = getGatarAtPosition(selFloorData, row, col);
                        if (g !== null) {
                            const isSelectedGatar = selectedGatars.includes(g);
                            html += `
                                <div id="gatar-${g}"
                                    onclick="selectGatar(${g})"
                                    class="gatar-cell p-1 text-center rounded cursor-pointer border border-gray-200 font-mono text-xs font-bold transition-all
                                        ${isSelectedGatar
                                            ? 'bg-green-500 text-white'
                                            : 'bg-white hover:bg-blue-100 hover:border-blue-400'}">
                                    ${g}
                                </div>
                            `;
                        }
                    }
                }

                html += `
                            </div>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="text-center p-4 bg-gray-50 border-2 border-dashed border-gray-300 rounded">
                        <i class="bi bi-arrow-up text-2xl text-gray-400"></i>
                        <p class="text-gray-500 mt-2">Select a floor above to see gatar numbers</p>
                    </div>
                `;
            }

            html += `
                </div>
            `;

            layoutDiv.innerHTML = html;
        }

        // Function to update gatar hint based on selection
        function updateGatarHint() {
            const roomNo = document.getElementById('roomNo').value;
            const floor = document.getElementById('floor').value;
            const hintDiv = document.getElementById('gatarHint');

            if (!hintDiv) return;

            if (roomNo && floor && gatarRanges[roomNo] && gatarRanges[roomNo][floor]) {
                const floorData = gatarRanges[roomNo][floor];
                let rangeText = '';
                if (floorData.ranges) {
                    rangeText = floorData.ranges.map(r => `${r.start}-${r.end}`).join(' + ');
                } else {
                    rangeText = `${floorData.start} - ${floorData.end}`;
                }
                hintDiv.innerHTML = `<span class="text-green-600 font-bold">Gatar Range: ${rangeText}</span>`;
                hintDiv.classList.remove('hidden');
            } else if (roomNo && floor) {
                hintDiv.innerHTML = `<span class="text-yellow-600">Gatar range not available for this selection</span>`;
                hintDiv.classList.remove('hidden');
            } else {
                hintDiv.classList.add('hidden');
            }

            // Update room layout display
            if (roomNo) {
                displayRoomLayout(roomNo);
            }
        }

        // Check operation mode on page load and redirect if needed
        async function checkOperationMode() {
            try {
                const response = await fetch('/api/settings/operation_mode', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const setting = await response.json();
                    if (setting.setting_value === 'unloading') {
                        // Redirect to unloading tickets page in unloading mode
                        window.location.href = '/unloading-tickets';
                        return false;
                    }
                }
            } catch (error) {
                console.error('Error checking operation mode:', error);
            }
            return true;
        }

        // Quantity Calculator Functions
        function addQuantity(value) {
            if (value && value > 0) {
                // Set pending quantity and show it
                pendingQuantity = value;
                document.getElementById('pendingQtyValue').textContent = value;
                document.getElementById('pendingQtyDisplay').classList.remove('hidden');

                // Also add to quantity values directly (without quality)
                quantityValues.push(value);
                updateQuantityDisplay();
                updateSelectionSummary(); // Update gatar distribution preview
            }
        }

        // Add quantity with quality mark (N/U/D/G)
        function addWithQuality(quality) {
            if (pendingQuantity && pendingQuantity > 0) {
                // Add quality remark for the last added quantity
                qualityRemarks.push({
                    quantity: pendingQuantity,
                    quality: quality
                });
                updateQualityRemarksDisplay();
                updateSelectionSummary(); // Update gatar distribution preview

                // Clear pending
                pendingQuantity = null;
                document.getElementById('pendingQtyDisplay').classList.add('hidden');
            }
        }

        function updateQualityRemarksDisplay() {
            const container = document.getElementById('qualityRemarksList');

            if (qualityRemarks.length === 0) {
                container.innerHTML = '';
                return;
            }

            // Get quality colors
            const qualityColors = {
                'N': { bg: 'bg-green-500', text: 'text-white' },
                'U': { bg: 'bg-yellow-500', text: 'text-white' },
                'D': { bg: 'bg-red-500', text: 'text-white' },
                'G': { bg: 'bg-blue-500', text: 'text-white' }
            };

            container.innerHTML = qualityRemarks.map((item, index) => {
                const style = qualityColors[item.quality] || { bg: 'bg-gray-500', text: 'text-white' };
                return `
                    <span class="inline-flex items-center gap-1 px-2 py-1 ${style.bg} ${style.text} rounded text-sm font-bold">
                        ${item.quantity}-${item.quality}
                        <button type="button" onclick="removeQualityRemark(${index})" class="hover:bg-red-700 rounded p-0.5" title="Remove">
                            <i class="bi bi-x text-xs"></i>
                        </button>
                    </span>
                `;
            }).join('');
        }

        function removeQualityRemark(index) {
            // Remove from quality remarks
            qualityRemarks.splice(index, 1);
            updateQualityRemarksDisplay();
        }

        function getQualityRemarksString() {
            // Generate remark string like "10-N, 5-U, 8-D"
            return qualityRemarks.map(item => `${item.quantity}-${item.quality}`).join(', ');
        }

        function showCustomInput() {
            document.getElementById('customInputDiv').classList.remove('hidden');
            document.getElementById('customQuantityInput').focus();
        }

        function hideCustomInput() {
            document.getElementById('customInputDiv').classList.add('hidden');
            document.getElementById('customQuantityInput').value = '';
        }

        function addCustomQuantity() {
            const customInput = document.getElementById('customQuantityInput');
            const value = parseInt(customInput.value);

            if (value && value > 0) {
                hideCustomInput();
                addQuantity(value);  // This will show the quality modal
            } else {
                alert(i18n.t('error', 'Error') + ': ' + i18n.t('quantity', 'Quantity') + ' > 0');
            }
        }

        function removeQuantity(index) {
            quantityValues.splice(index, 1);
            // Also remove corresponding quality remark if exists
            if (qualityRemarks[index]) {
                qualityRemarks.splice(index, 1);
                updateQualityRemarksDisplay();
            }
            updateQuantityDisplay();
            updateSelectionSummary(); // Update gatar distribution preview
        }

        function clearAllQuantities() {
            quantityValues = [];
            qualityRemarks = [];
            pendingQuantity = null;
            document.getElementById('pendingQtyDisplay').classList.add('hidden');
            updateQuantityDisplay();
            updateQualityRemarksDisplay();
            updateSelectionSummary(); // Update gatar distribution preview
        }

        function updateQuantityDisplay() {
            const chipsContainer = document.getElementById('quantityChips');
            const totalDisplay = document.getElementById('totalQuantity');
            const totalDisplayInForm = document.getElementById('totalQuantityDisplay');
            const hiddenInput = document.getElementById('quantity');

            // Calculate total
            const total = quantityValues.reduce((sum, val) => sum + val, 0);

            // Update total displays
            totalDisplay.textContent = total;
            if (totalDisplayInForm) {
                totalDisplayInForm.textContent = total;
            }

            // Update hidden input for form submission
            hiddenInput.value = total;

            // Update chips display
            if (quantityValues.length === 0) {
                const clickMsg = i18n.t('click_values_add', 'Click values above to add...');
                chipsContainer.innerHTML = `<span class="text-sm text-gray-400 self-center">${clickMsg}</span>`;
            } else {
                chipsContainer.innerHTML = quantityValues.map((val, index) => `
                    <span class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-full text-lg font-bold shadow-md">
                        ${val}
                        <button type="button" onclick="removeQuantity(${index})" class="hover:bg-red-500 rounded-full p-1 transition-colors" title="Remove">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </span>
                `).join('');
            }

            // Check for quantity warning (less than expected)
            checkQuantityWarning();
        }

        // Check if quantity is less than expected and show warning
        function checkQuantityWarning() {
            if (!selectedEntry) return;

            const enteredQty = parseInt(document.getElementById('quantity').value) || 0;
            const expectedQty = selectedEntry.expectedQty;
            const warningDiv = document.getElementById('quantityWarning');
            const warningMsg = document.getElementById('warningMessage');

            if (enteredQty > 0 && enteredQty < expectedQty) {
                // Less than expected - show warning
                const lessText = i18n.t('quantity_less_warning', 'Quantity LESS');
                const enteredText = i18n.t('entered', 'entered');
                const expectedText = i18n.t('expected', 'expected');
                warningMsg.textContent = `${lessText}: ${enteredQty} ${enteredText}, ${expectedQty} ${expectedText}`;
                warningDiv.classList.remove('hidden');
                // Auto-check "Less" remark
                const lessCheckbox = document.querySelector('input[name="remarkType"][value="less"]');
                if (lessCheckbox) {
                    lessCheckbox.checked = true;
                }
            } else {
                warningDiv.classList.add('hidden');
                noRemarkConfirmed = false;
                // Uncheck "Less" remark if quantity is back to normal
                const lessCheckbox = document.querySelector('input[name="remarkType"][value="less"]');
                if (lessCheckbox) {
                    lessCheckbox.checked = false;
                }
            }
        }

        // Confirm no remark needed for less quantity
        // Keep "less" checked so it's recorded in the remark
        function confirmNoRemark() {
            noRemarkConfirmed = true;
            document.getElementById('quantityWarning').classList.add('hidden');
            // Keep "Less" checkbox checked - we want to record "less" in the remark
            // The "No Remark" button just confirms user acknowledged the warning
        }

        // Load data on page load
        window.addEventListener('load', async function() {
            // Check operation mode first - redirect if in unloading mode
            const shouldContinue = await checkOperationMode();
            if (!shouldContinue) return;

            loadUnassignedEntries();
            loadRoomEntries();
            startAutoRefresh();
        });

        // Start auto-refresh for unassigned entries
        function startAutoRefresh() {
            entriesRefreshInterval = setInterval(() => {
                loadUnassignedEntries();
            }, 5000); // Refresh every 5 seconds
        }

        // Stop auto-refresh when leaving page
        window.addEventListener('beforeunload', function() {
            if (entriesRefreshInterval) {
                clearInterval(entriesRefreshInterval);
            }
        });

        async function loadUnassignedEntries() {
            // Show loading animation
            const refreshIcon = document.getElementById('refreshIcon');
            if (refreshIcon) {
                refreshIcon.classList.add('spin-animation');
            }

            try {
                const response = await fetch('/api/entries/unassigned', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) {
                    throw new Error('Failed to load unassigned entries');
                }

                const entries = await response.json();
                displayUnassignedEntries(entries);
            } catch (error) {
                console.error('Error loading unassigned entries:', error);
                const errorMsg = i18n.t('failed_load_entries', 'Failed to load entries');
                document.getElementById('unassignedEntriesTableBody').innerHTML =
                    `<tr><td colspan="3" class="text-center p-4 text-red-500">${errorMsg}</td></tr>`;
            } finally {
                // Stop loading animation
                if (refreshIcon) {
                    setTimeout(() => {
                        refreshIcon.classList.remove('spin-animation');
                    }, 500);
                }
            }
        }

        function displayUnassignedEntries(entries) {
            const tbody = document.getElementById('unassignedEntriesTableBody');

            if (entries.length === 0) {
                const noEntriesMsg = i18n.t('no_unassigned_entries', 'No unassigned entries');
                tbody.innerHTML = `<tr><td colspan="3" class="text-center p-4 text-gray-500">${noEntriesMsg}</td></tr>`;
                return;
            }

            tbody.innerHTML = entries.map(entry => {
                const thockColor = getThockColor(entry.thock_number);
                const entrySO = entry.so || '';
                const entryVariety = entry.remark || '';
                const actualQty = entry.actual_quantity || 0;
                // Display: "23 → 22" if different, or just "22" if same/not stored yet
                const qtyDisplay = actualQty > 0
                    ? (entry.expected_quantity !== actualQty ? `${entry.expected_quantity} → ${actualQty}` : `${actualQty}`)
                    : `${entry.expected_quantity}`;
                // Escape single quotes in variety for onclick
                const escapedVariety = entryVariety.replace(/'/g, "\\'");
                return `
                    <tr class="border-b border-gray-200 clickable-row" onclick="selectEntry(${entry.id}, '${entry.thock_number}', '${entry.name}', ${entry.expected_quantity}, '${entrySO}', ${actualQty}, '${escapedVariety}')">
                        <td class="p-2 font-bold" style="${thockColor}">${entry.thock_number}</td>
                        <td class="p-2">${entry.name}${entryVariety ? '<br><span class="text-xs text-green-600"><i class="bi bi-tag"></i> ' + entryVariety + '</span>' : ''}</td>
                        <td class="p-2">${qtyDisplay}</td>
                    </tr>
                `;
            }).join('');
        }

        function selectEntry(entryId, thockNumber, name, expectedQty, so = '', actualQty = 0, variety = '') {
            selectedEntry = { entryId, thockNumber, name, expectedQty, so, actualQty, variety };

            // Detect entry type and update room availability
            currentEntryType = getEntryType(thockNumber);
            updateRoomAvailability(currentEntryType);

            // Update UI
            document.getElementById('entryId').value = entryId;
            document.getElementById('selectedThockNumber').textContent = thockNumber;

            // Show entry type badge with both expected and actual if different
            const typeLabel = currentEntryType === 'seed' ? 'बीज' : 'बिक्री';
            const typeColor = currentEntryType === 'seed' ? 'bg-green-500' : 'bg-orange-500';
            const qtyDisplay = actualQty > 0 && expectedQty !== actualQty
                ? `Expected: ${expectedQty} → Actual: ${actualQty}`
                : `Expected: ${expectedQty}`;
            document.getElementById('selectedEntryDetails').innerHTML = `${name} - ${qtyDisplay} <span class="${typeColor} text-white text-xs px-2 py-1 rounded ml-2">${typeLabel}</span>`;

            // Display S/O (Son Of / Father's Name)
            const soElement = document.getElementById('selectedEntrySO');
            if (so && so.trim() !== '') {
                soElement.textContent = `S/O: ${so}`;
            } else {
                soElement.textContent = '';
            }

            // Display Variety/Remark
            const varietyElement = document.getElementById('selectedEntryVariety');
            if (variety && variety.trim() !== '') {
                varietyElement.innerHTML = `<i class="bi bi-tag-fill mr-1"></i>Variety: ${variety}`;
            } else {
                varietyElement.textContent = '';
            }

            // Highlight selected row
            document.querySelectorAll('.clickable-row').forEach(row => {
                row.classList.remove('selected-entry');
            });
            event.currentTarget.classList.add('selected-entry');
        }

        async function loadRoomEntries() {
            try {
                const response = await fetch('/api/room-entries', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) {
                    throw new Error('Failed to load room entries');
                }

                const roomEntries = await response.json();
                displayRoomEntries(roomEntries);
            } catch (error) {
                console.error('Error loading room entries:', error);
                const errorMsg = i18n.t('failed_load_room_entries', 'Failed to load room entries');
                document.getElementById('roomEntriesTableBody').innerHTML =
                    `<tr><td colspan="7" class="text-center p-4 text-red-500">${errorMsg}</td></tr>`;
            }
        }

        function displayRoomEntries(roomEntries) {
            const tbody = document.getElementById('roomEntriesTableBody');

            if (roomEntries.length === 0) {
                const noEntriesMsg = i18n.t('no_room_entries', 'No room entries yet');
                tbody.innerHTML = `<tr><td colspan="7" class="text-center p-4 text-gray-500">${noEntriesMsg}</td></tr>`;
                return;
            }

            tbody.innerHTML = roomEntries.map(entry => {
                const date = new Date(entry.created_at);
                const formattedDate = date.toLocaleString('en-IN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const thockColor = getThockColor(entry.thock_number);

                const breakdownDisplay = entry.quantity_breakdown ? `<span class="text-xs text-gray-500">(${entry.quantity_breakdown})</span>` : '';
                const varietyDisplay = entry.variety ? `<br><span class="text-xs text-green-600"><i class="bi bi-tag"></i> ${entry.variety}</span>` : '';

                return `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="p-2 font-bold" style="${thockColor}">${entry.thock_number}${varietyDisplay}</td>
                        <td class="p-2">${entry.room_no}</td>
                        <td class="p-2">${entry.floor}</td>
                        <td class="p-2">${entry.gate_no}</td>
                        <td class="p-2">${entry.remark || '-'}</td>
                        <td class="p-2">${entry.quantity} ${breakdownDisplay}</td>
                        <td class="p-2 text-sm">${formattedDate}</td>
                    </tr>
                `;
            }).join('');
        }

        function toggleCustomRemark() {
            const customCheckbox = document.querySelector('input[name="remarkType"][value="custom"]');
            const customInput = document.getElementById('customRemark');

            if (customCheckbox && customCheckbox.checked) {
                customInput.classList.remove('hidden');
            } else {
                customInput.classList.add('hidden');
            }
        }

        // Add event listeners to all remark checkboxes
        document.querySelectorAll('input[name="remarkType"]').forEach(checkbox => {
            checkbox.addEventListener('change', toggleCustomRemark);
        });

        async function submitRoomEntry(event) {
            event.preventDefault();

            if (!selectedEntry) {
                alert(i18n.t('select_entry_first', 'Please select an entry from Recent Main Entries'));
                return;
            }

            const roomNo = document.getElementById('roomNo').value;
            const floor = document.getElementById('floor').value;
            const gateNo = document.getElementById('gateNo').value.trim();
            const quantity = parseInt(document.getElementById('quantity').value);

            // Check if quantity is less than expected and remark is required
            const expectedQty = selectedEntry.expectedQty;
            if (quantity > 0 && quantity < expectedQty) {
                const hasRemark = document.querySelectorAll('input[name="remarkType"]:checked').length > 0;
                if (!hasRemark && !noRemarkConfirmed) {
                    alert(i18n.t('remark_required_less', 'Quantity is less than expected. Please add a remark or click "No Remark" to confirm.'));
                    return;
                }
            }

            // Get remarks (multiple checkboxes)
            const checkedRemarks = [];
            document.querySelectorAll('input[name="remarkType"]:checked').forEach(cb => {
                if (cb.value !== 'custom') {
                    checkedRemarks.push(cb.value);
                }
            });
            // Add custom remark if custom checkbox is checked
            const customCheckbox = document.querySelector('input[name="remarkType"][value="custom"]');
            if (customCheckbox && customCheckbox.checked) {
                const customRemark = document.getElementById('customRemark').value.trim();
                if (customRemark) {
                    checkedRemarks.push(customRemark);
                }
            }

            // Add quality remarks (N/U/D/G) to the remark
            const qualityRemarksStr = getQualityRemarksString();
            if (qualityRemarksStr) {
                checkedRemarks.push(qualityRemarksStr);
            }

            const remark = checkedRemarks.join(', ');

            // Get quantity breakdown
            const quantityBreakdown = quantityValues.join(', ');

            // Build gatars array by mapping quantityValues to selectedGatars
            const gatarsArray = [];
            if (selectedGatars.length > 0 && quantityValues.length > 0) {
                // Validate: number of gatars must equal number of quantity values
                if (selectedGatars.length !== quantityValues.length) {
                    alert(i18n.t('gatar_qty_mismatch', `Mismatch: ${selectedGatars.length} gatars selected but ${quantityValues.length} quantities entered. They must match!`));
                    return;
                }
                // Map each gatar to its corresponding quantity and quality
                selectedGatars.forEach((gatarNo, idx) => {
                    const qty = quantityValues[idx] || 0;
                    const quality = qualityRemarks[idx]?.quality || 'N';
                    if (qty > 0) {
                        gatarsArray.push({
                            gatar_no: gatarNo,
                            quantity: qty,
                            quality: quality
                        });
                    }
                });
            }

            const roomEntryData = {
                entry_id: selectedEntry.entryId,
                thock_number: selectedEntry.thockNumber,
                room_no: roomNo,
                floor: floor,
                gate_no: gateNo,
                remark: remark,
                quantity: quantity,
                quantity_breakdown: quantityBreakdown,
                gatars: gatarsArray
            };

            try {
                const response = await fetch('/api/room-entries', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(roomEntryData)
                });

                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(error);
                }

                const result = await response.json();
                const successMsg = i18n.t('room_entry_success', 'Room entry created successfully!');
                const thokLabel = i18n.t('thok', 'Thok');
                const locationLabel = i18n.t('location', 'Location');
                const roomLabel = i18n.t('room', 'Room');
                const floorLabel = i18n.t('floor', 'Floor');
                const gatarLabel = i18n.t('gatar', 'Gatar');
                alert(`${successMsg}\n${thokLabel}: ${result.thock_number}\n${locationLabel}: ${roomLabel} ${result.room_no}, ${floorLabel} ${result.floor}, ${gatarLabel} ${result.gate_no}`);

                // Reload data
                loadUnassignedEntries();
                loadRoomEntries();
                resetForm();
            } catch (error) {
                alert(i18n.t('error', 'Error') + ': ' + error.message);
            }
        }

        function resetForm() {
            document.getElementById('roomEntryForm').reset();
            document.getElementById('selectedThockNumber').textContent = '-';
            document.getElementById('selectedEntryDetails').textContent = '';
            document.getElementById('selectedEntrySO').textContent = '';
            document.getElementById('selectedEntryVariety').textContent = '';
            document.getElementById('customRemark').classList.add('hidden');
            selectedEntry = null;

            // Reset quantity warning state
            noRemarkConfirmed = false;
            document.getElementById('quantityWarning').classList.add('hidden');

            // Clear selected gatars and per-gatar quantities
            selectedGatars = [];
            gatarQuantities = {};

            // Clear room selection
            document.querySelectorAll('.room-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Clear quantity calculator and quality remarks
            clearAllQuantities();

            // Remove highlighting
            document.querySelectorAll('.clickable-row').forEach(row => {
                row.classList.remove('selected-entry');
            });

            // Reset room layout display
            const layoutDiv = document.getElementById('roomLayoutDisplay');
            if (layoutDiv) {
                layoutDiv.innerHTML = `
                    <div class="text-center p-4 bg-gray-50 border-2 border-dashed border-gray-300 rounded">
                        <p class="text-gray-500">Select a room to see gatar layout</p>
                    </div>
                `;
            }

            // Hide gatar hint
            const hintDiv = document.getElementById('gatarHint');
            if (hintDiv) {
                hintDiv.classList.add('hidden');
            }
        }

        function getThockColor(thockNumber) {
            const numMatch = thockNumber.match(/^(\d+)/);
            if (numMatch) {
                const num = parseInt(numMatch[1]);
                return num <= 1500 ? 'color: #16a34a; font-weight: bold;' : 'color: #ea580c; font-weight: bold;';
            }
            return 'color: #374151; font-weight: bold;';
        }

        function selectRoom(roomNumber) {
            const btn = document.getElementById(`room-btn-${roomNumber}`);

            // Check if room is disabled
            if (btn && btn.disabled) {
                return; // Don't allow selecting disabled rooms
            }

            // Update hidden input
            document.getElementById('roomNo').value = roomNumber;

            // Clear selected gatars when room changes
            selectedGatars = [];
            document.getElementById('gateNo').value = '';

            // Remove selected styling from all room buttons and restore default colors
            document.querySelectorAll('.room-btn').forEach(b => {
                b.classList.remove('selected', 'bg-green-500', 'bg-orange-500', 'text-white', 'border-green-600', 'border-orange-600');
                const roomType = b.getAttribute('data-type');
                if (!b.disabled) {
                    if (roomType === 'seed') {
                        b.classList.add('bg-green-100', 'border-green-400');
                    } else {
                        b.classList.add('bg-orange-100', 'border-orange-400');
                    }
                }
            });

            // Add selected styling to clicked button with correct color
            if (btn) {
                btn.classList.add('selected', 'text-white');
                btn.classList.remove('bg-green-100', 'bg-orange-100', 'border-green-400', 'border-orange-400');
                if (roomTypes[roomNumber] === 'seed') {
                    btn.classList.add('bg-green-500', 'border-green-600');
                } else {
                    btn.classList.add('bg-orange-500', 'border-orange-600');
                }
            }

            // Update gatar hint and room layout display
            updateGatarHint();
        }

        function selectFloor(floorNumber) {
            // Update hidden input
            document.getElementById('floor').value = floorNumber;

            // Clear selected gatars when floor changes
            selectedGatars = [];
            document.getElementById('gateNo').value = '';

            // Update gatar hint and room layout display
            updateGatarHint();
        }

        function goBack() {
            window.history.back();
        }
    </script>

</body>
</html>
